/** 
* Video - v0.0.3.
* https://github.com/mkay581/video.git
* Copyright 2015. Licensed MIT.
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["underscore"],function(b){return a(b)}):a(window._)}(function(a){"use strict";var b=function(){};b.prototype={initialize:function(c){var d=c.el||document.createDocumentFragment();this.options=a.extend({el:d,src:d.getAttribute("src"),autoplay:d.getAttribute("autoplay")},c),b.prototype.vidCount=b.prototype.vidCount||0,b.prototype.vidCount++,this.vpid="v"+b.prototype.vidCount},addEventListener:function(){this.el.addEventListener.apply(this,arguments)},removeEventListener:function(){this.el.removeEventListener.apply(this,arguments)},load:function(){this.el.load()},play:function(){this.el.play()},pause:function(){this.el.pause()},destroy:function(){}};var c=function(a){this.initialize(a)};return c.prototype=a.extend({},b.prototype,{initialize:function(d){var e=d.el||document.createDocumentFragment();this.options=a.extend({el:e,autoplay:e.getAttribute("autoplay"),width:e.getAttribute("width"),height:e.getAttribute("height"),playingCssClass:"video-playing",loadingCssClass:"video-loading"},d),b.prototype.initialize.call(this,this.options),c.prototype.players=c.prototype.players||{},this.el=this.options.el,this._container=this.el.kit.appendOuterHtml('<div id="vplayer'+this.vpid+'-container"></div>')},getSourceUrl:function(){var a,b,c=this.el.getElementsByTagName("source"),d=c.length;if(!this.src)for(a=0;d>a;a++)if(b=c[a],"video/youtube"===b.getAttribute("type")){this.src=b.getAttribute("src");break}return this.src},load:function(a){this._container.kit.classList.add(this.options.loadingCssClass),this._loadScript(function(){this._buildPlayer(function(b){this.player=b,this._container.kit.classList.remove(this.options.loadingCssClass),a&&a(b)}.bind(this))}.bind(this))},_buildPlayer:function(a){var b=function(b){a&&a(b)};this._p?b(this._p):this._p=this._createPlayer(b)},_createPlayer:function(a){var b="vplayer"+this.vpid;this._ytEl=document.createElement("div"),this._ytEl.setAttribute("id",b),this._container.appendChild(this._ytEl),this._container.removeChild(this.el);var d=new YT.Player(b,{height:this.options.height,width:this.options.width,videoId:this.extractVideoIdFromUrl(this.getSourceUrl()),events:{onReady:function(b){a(b.target)},onStateChange:this._onStateChange.bind(this)}});return c.prototype.players[this.vpid]=this,d},extractVideoIdFromUrl:function(a){if(a){var b=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi;a=a.replace(b,"$1")}return a},_loadScript:function(a){if(c.prototype._script)a?a():null;else{var b=document.createElement("script");b.src="https://www.youtube.com/iframe_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d),c.prototype._script=b,window.onYouTubeIframeAPIReady=function(){a?a():null}.bind(this)}},_onStateChange:function(a){var b={"-1":{name:"unstarted"},0:{name:"ended",method:this.onEnd},1:{name:"playing",method:this.onPlay},2:{name:"paused",method:this.onPause},3:{name:"buffering"},5:{name:"cued"}};a=""+a,b[a].method&&b[a].method.call(this)},_triggerEvent:function(a){var b=document.createEvent("CustomEvent");b.initCustomEvent(a,!1,!1,null),this.el.dispatchEvent(b)},play:function(){this.getSourceUrl()?this.player.playVideo():console.warn("youtube video error: you cannot call play() method on a video element that has no youtube source url")},onPlay:function(){this._container.classList.add(this.options.playingCssClass),this._triggerEvent("play")},pause:function(){this.player.pauseVideo()},onPause:function(){this._container.classList.remove(this.options.playingCssClass),this._triggerEvent("pause")},stop:function(){this.player.stopVideo()},onEnd:function(){this._container.classList.remove(this.options.playingCssClass),this._triggerEvent("ended")},destroy:function(){var d=c.prototype._script,e=c.prototype.players;delete e[this.vpid],d&&!a.keys(e).length&&(d.parentNode.removeChild(d),c.prototype._script=null),this._container.parentNode.replaceChild(this.el,this._container),b.prototype.destroy.call(this)}}),{Youtube:c}}),function(){"use strict";function a(a){var b,c;return a?(a=a.trim(a),b=document.createElement("div"),b.innerHTML=a,c=b.childNodes[0],b.removeChild(c)):void 0}function b(a){var b,c,d=a;for(c=1;c<arguments.length;c++){b=arguments[c];for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e])}return d}var c=0,d={},e=function(a){this.el=a,this.classList=this._getClassList(),this._eventListenerMap=this._eventListenerMap||[],Object.defineProperty(this,"dataset",{get:function(){return this.getData()}.bind(this)})};e.prototype={appendOuterHtml:function(b){var c=this.el.parentNode,d=a(b);return c.replaceChild(d,this.el),d.appendChild(this.el),d},getUniqueId:function(){return this.el._kitId},getClosestAncestorElementByClassName:function(a){for(var b,c=this.el.parentNode;c&&"string"==typeof c.className;){if(c.kit._hasClass(a)){b=c;break}c=c.parentNode}return b},addEventListener:function(a,b,c,d){var e=b;d=d||{},"function"!=typeof e&&(e=this._createEventListener(c[b],c)),this.el.addEventListener(a,e,d.useCapture),this._eventListenerMap.push({event:a,listener:e,listenerId:b,context:c})},_createEventListener:function(a,b){return function(){b=b||this,a.apply(b,arguments)}},removeEventListener:function(a,b,c){var d,e,f=this._eventListenerMap||[];if(f.length)for(d=0;d<f.length;d++)if(e=f[d],e&&e.event===a&&e.listenerId===b&&e.context===c){this.el.removeEventListener(a,e.listener),this._eventListenerMap[d]=null;break}},waitForTransition:function(a){var b=this.getTransitionDuration();a&&(b>0?setTimeout(a.bind(this,this.el),b):a(this.el))},getTransitionDuration:function(){var a=this.getCssComputedProperty("transition-delay")||"0ms",b=this.getCssComputedProperty("transition-duration")||"0ms";return a=this._convertCssTimeValueToMilliseconds(a),b=this._convertCssTimeValueToMilliseconds(b),a+b},getCssComputedProperty:function(a){var b=window.getComputedStyle(this.el);return b.getPropertyValue(a)||this.el.style[this._getJsPropName(a)]},_convertCssTimeValueToMilliseconds:function(a){var b=this._convertCssUnitToNumber(a),c=a.replace(b,"");return a="s"===c?1e3*b:b},_convertCssUnitToNumber:function(a){return Number(a.replace(/[a-z]+/,""))},_getClassList:function(){return{add:this._addClass.bind(this),remove:this._removeClass.bind(this),contains:this._hasClass.bind(this),toggle:this._toggleClass.bind(this)}},_getCssClasses:function(){return this.el.className.split(" ")},_toggleClass:function(a){this._hasClass(a)?this._removeClass(a):this._addClass(a)},_addClass:function(a){a&&!this._hasClass(a)&&(this.el.classList?this.el.classList.add(a):this.el.className=this.el.className+a)},_removeClass:function(a){var b;a&&this._hasClass(a)&&(this.el.classList?this.el.classList.remove(a):this.el.className===a?this.el.className="":(b="[\\s]*"+a,b=new RegExp(b,"i"),this.el.className=this.el.className.replace(b,"")))},_hasClass:function(a){var b=this._getCssClasses();return-1!==b.indexOf(a)},_getJsPropName:function(a){return a=a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},getAttributes:function(){var a=this.el.attributes,b={};if(a.length)for(var c=0;c<a.length;c++)b[a[c].name]=a[c].value;return b},_getDomData:function(){var a,b,c=this.getAttributes(),d={};for(a in c)c.hasOwnProperty(a)&&(b=c[a],0===a.indexOf("data-")&&(a=a.substr(5),d[a]=b));return d},getData:function(){var a;this._data=b({},this._data,this._getDomData());for(a in this._data)if(this._data.hasOwnProperty(a)){var c=this._data[a];Object.defineProperty(this._data,a,{writeable:!0,get:function(){return c}.bind(this),set:function(b){this.setData.bind(this,a,b)}.bind(this)})}return this._data},setData:function(a,b){this.el.setAttribute("data-"+a,b),this._data[a]=b}},Object.defineProperty(Element.prototype,"kit",{get:function(){return d[this._kitId]||(c++,this._kitId=c,d[this._kitId]=new e(this)),d[this._kitId]}})}();